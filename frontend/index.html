<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MCP Client</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="light-mode">
    <div id="app" class="app-container">
        <aside id="sidebar" class="sidebar collapsed">
            <div class="sidebar-header">
                <h2>MCP Client</h2>
                <button id="close-sidebar" class="mobile-only">‚úï</button>
            </div>
            <div class="sidebar-content">
                <section class="sidebar-section">
                    <div class="section-header">
                        <h3>LLM Council</h3>
                    </div>
                    <div id="model-list" class="list-container"></div>
                    <div class="council-toggle">
                        <label>
                            <input type="checkbox" id="council-mode-toggle">
                            Council Mode
                        </label>
                        <span id="council-badge" class="badge hidden">Council [0]</span>
                    </div>
                </section>

                <section class="sidebar-section">
                    <div class="section-header">
                        <h3>MCP Servers</h3>
                        <button id="add-server-btn" class="icon-btn" title="Add Server">+</button>
                    </div>
                    <div id="server-list" class="list-container"></div>
                </section>

                <section class="sidebar-section settings">
                    <div class="section-header">
                        <h3>Settings</h3>
                    </div>
                    <button id="open-llm-keys-btn" class="btn-secondary">üîë Manage LLM Keys</button>
                    <button id="theme-toggle" class="btn-secondary">Toggle Dark Mode</button>
                    <button id="export-history" class="btn-secondary">Export History</button>
                    <button id="clear-history" class="btn-danger">Clear History</button>
                    <button id="reset-app" class="btn-danger">Reset All</button>
                </section>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <button id="open-sidebar" class="mobile-only">‚ò∞</button>
                <div id="active-model-info">Disconnected</div>
                <div class="header-actions">
                    <button id="open-tool-modal" class="icon-btn" title="Run Tool">üõ†Ô∏è</button>
                </div>
                <div id="app-status" class="status-indicator">‚óè IDLE</div>
            </header>

            <div id="chat-container" class="chat-container">
                <div id="chat-messages" class="chat-messages"></div>
            </div>

            <footer class="input-area">
                <div id="upload-preview" class="upload-preview"></div>
                <div class="input-container">
                    <button id="attach-btn" class="icon-btn" title="Attach File">üìé</button>
                    <textarea id="chat-input" placeholder="Type a message..." rows="1"></textarea>
                    <button id="send-btn" class="icon-btn send-btn" title="Send Message">‚û§</button>
                </div>
                <input type="file" id="file-input" multiple style="display: none;">
            </footer>
        </main>

        <div id="modal-overlay" class="modal-overlay hidden">
            <div id="server-modal" class="modal hidden">
                <h3>Add MCP Server</h3>
                <form id="server-form">
                    <div class="form-group">
                        <label>Server Name</label>
                        <input type="text" id="server-name" required placeholder="e.g. Klavis Strata">
                    </div>
                    <div class="form-group">
                        <label>Server URL</label>
                        <input type="url" id="server-url" required placeholder="https://strata.klavis.ai/mcp/">
                    </div>
                    <div class="form-group">
                        <label>Headers (JSON, optional)</label>
                        <textarea id="server-headers" rows="4" placeholder='{"Authorization": "Bearer YOUR_TOKEN"}'></textarea>
                        <small class="help-text">Leave empty for servers that don't require authentication</small>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="test-server-btn" class="btn-secondary">Test Connection</button>
                        <button type="button" id="cancel-server-btn" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>

            <div id="tool-modal" class="modal hidden">
                <h3>Run Tool</h3>
                <form id="tool-form">
                    <div class="form-group">
                        <label>Tool</label>
                        <select id="tool-select" required></select>
                    </div>
                    <div class="form-group">
                        <label>Arguments (JSON)</label>
                        <textarea id="tool-args" rows="6" placeholder='{}'></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancel-tool-btn" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Run</button>
                    </div>
                </form>
            </div>

            <!-- LLM API Keys Modal -->
            <div id="llm-modal" class="modal hidden">
                <h3>Manage LLM API Keys</h3>
                <form id="llm-form">
                    <div class="form-group">
                        <label>LLM Service Name</label>
                        <input type="text" id="llm-service-name" required placeholder="e.g., OpenRouter, Claude, Gemini">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="llm-api-key" required placeholder="Paste your API key here">
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancel-llm-btn" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save Key</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
